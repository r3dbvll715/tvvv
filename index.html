<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Canais Portugueses - M3UPT (Legal)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f0f0f0; }
        header { background: #003399; color: white; padding: 20px; text-align: center; }
        .container { display: flex; height: calc(100vh - 80px); }
        #channel-list { width: 300px; background: #fff; overflow-y: auto; border-right: 1px solid #ccc; padding: 10px; }
        #channel-list ul { list-style: none; padding: 0; margin: 0; }
        #channel-list li { padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; }
        #channel-list li:hover { background: #e0e0ff; }
        #channel-list img { width: 30px; height: 30px; vertical-align: middle; margin-right: 10px; border-radius: 4px; }
        #video-container { flex: 1; display: flex; align-items: center; justify-content: center; background: #000; }
        video { max-width: 100%; max-height: 100%; }
        footer { background: #333; color: white; text-align: center; padding: 10px; font-size: 0.9em; }
    </style>
    <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet">
</head>
<body>
    <header>
        <h1>Canais Portugueses Gratuitos (M3UPT - Streams Oficiais)</h1>
        <p>Playlist legal e atualizada: RTP, SIC, TVI, Notícias, Rádios e +100 câmaras de praias</p>
    </header>

    <div class="container">
        <div id="channel-list">
            <p>A carregar canais... (pode demorar uns segundos)</p>
        </div>

        <div id="video-container">
            <video id="player" class="video-js vjs-default-skin" controls preload="none" width="800" height="450">
                <p class="vjs-no-js">
                    Para ver vídeos, ativa o JavaScript ou usa um browser moderno.
                </p>
            </video>
        </div>
    </div>

    <footer>
        Playlist oficial: <a href="https://m3upt.com/iptv" target="_blank" style="color: #fff;">https://m3upt.com/iptv</a> | 
        Projeto open-source: <a href="https://github.com/LITUATUI/M3UPT" target="_blank" style="color: #fff;">GitHub</a><br>
        Alguns canais podem precisar de VPN com IP português se estiveres fora de Portugal.
    </footer>

    <script>
        const playlistUrl = 'https://raw.githubusercontent.com/LITUATUI/M3UPT/main/M3U/M3UPT.m3u';
        const channelList = document.getElementById('channel-list');
        const videoPlayer = videojs('player');

        console.log('Fetching playlist from:', playlistUrl);

        fetch(playlistUrl)
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok: ' + response.statusText);
                return response.text();
            })
            .then(data => {
                console.log('Playlist fetched successfully, length:', data.length);
                const lines = data.split('\n');
                let ul = document.createElement('ul');
                let currentChannel = null;

                lines.forEach(line => {
                    if (line.startsWith('#EXTINF:')) {
                        const nameMatch = line.match(/,(.+)$/);
                        const logoMatch = line.match(/tvg-logo="([^"]+)"/);
                        currentChannel = {
                            name: nameMatch ? nameMatch[1].trim() : 'Canal sem nome',
                            logo: logoMatch ? logoMatch[1] : ''
                        };
                    } else if (line.startsWith('http') && currentChannel) {
                        const li = document.createElement('li');
                        li.innerHTML = currentChannel.logo 
                            ? `<img src="${currentChannel.logo}" alt="logo"> ${currentChannel.name}`
                            : currentChannel.name;
                        
                        li.onclick = () => {
                            videoPlayer.src({ type: 'application/x-mpegURL', src: line.trim() });
                            videoPlayer.play();
                            document.querySelectorAll('#channel-list li').forEach(el => el.style.background = '');
                            li.style.background = '#cce5ff';
                        };
                        ul.appendChild(li);
                        currentChannel = null;
                    }
                });

                channelList.innerHTML = '<h3>Canais e Rádios</h3>';
                channelList.appendChild(ul);
            })
            .catch(err => {
                channelList.innerHTML = '<p style="color:red;">Erro ao carregar a playlist. Verifica a ligação à internet ou tenta mais tarde.</p>';
                console.error(err);
            });
    </script>
</body>
</html>
